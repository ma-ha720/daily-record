<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥ã€…ã®è¨˜éŒ²ã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        @media print {
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹
        let state = {
            records: [],
            view: 'dashboard',
            showAddForm: false,
            selectedRecord: null,
            showExportOptions: false,
            searchQuery: '',
            filterTags: [],
            newRecord: {
                date: new Date().toISOString().split('T')[0],
                situation: '',
                insights: '',
                tags: []
            }
        };

        const tagOptions = [
            'æ„Ÿè¦šéæ•', 'å¯¾äººé–¢ä¿‚', 'å­¦ç¿’é¢', 'ä¸å®‰', 'æˆåŠŸä½“é¨“',
            'å¤±æ•—ä½“é¨“', 'ç’°å¢ƒèª¿æ•´', 'å£°ã‹ã‘', 'æœã®å›°é›£', 'å¤œã®å›°é›£',
            'é£Ÿäº‹', 'ç¡çœ ', 'å¤–å‡º', 'å®¶æ—é–¢ä¿‚', 'é€²æ­©', 'åœæ»', 'ç™‚è‚²æ”¾ãƒ‡ã‚¤ç­‰'
        ];

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
        function loadData() {
            const saved = localStorage.getItem('daily_records');
            if (saved) {
                try {
                    state.records = JSON.parse(saved);
                    // æ—¥ä»˜ã§ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
                    state.records.sort((a, b) => new Date(b.date) - new Date(a.date));
                } catch (e) {
                    console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                }
            }
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function saveData() {
            localStorage.setItem('daily_records', JSON.stringify(state.records));
        }

        // çµ±è¨ˆè¨ˆç®—
        function getStats() {
            const total = state.records.length;
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const last7Days = state.records.filter(r => new Date(r.date) >= weekAgo).length;
            
            // ã‚¿ã‚°åˆ¥é›†è¨ˆ
            const tagCounts = {};
            state.records.forEach(r => {
                r.tags.forEach(tag => {
                    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                });
            });
            
            return { total, last7Days, tagCounts };
        }

        // è¨˜éŒ²è¿½åŠ 
        function addRecord() {
            if (!state.newRecord.situation.trim()) {
                alert('çŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const record = {
                ...state.newRecord,
                id: Date.now(),
                createdAt: new Date().toISOString()
            };

            state.records = [record, ...state.records];
            saveData();
            state.showAddForm = false;
            state.newRecord = {
                date: new Date().toISOString().split('T')[0],
                situation: '',
                insights: '',
                tags: []
            };
            render();
        }

        // ã‚¿ã‚°åˆ‡ã‚Šæ›¿ãˆ
        function toggleTag(tag) {
            const tags = state.newRecord.tags;
            if (tags.includes(tag)) {
                state.newRecord.tags = tags.filter(t => t !== tag);
            } else {
                state.newRecord.tags = [...tags, tag];
            }
            render();
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¿ã‚°åˆ‡ã‚Šæ›¿ãˆ
        function toggleFilterTag(tag) {
            const tags = state.filterTags;
            if (tags.includes(tag)) {
                state.filterTags = tags.filter(t => t !== tag);
            } else {
                state.filterTags = [...tags, tag];
            }
            render();
        }

        // è¨˜éŒ²ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        function getFilteredRecords() {
            let filtered = [...state.records];
            
            // æ¤œç´¢ã‚¯ã‚¨ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿
            if (state.searchQuery.trim()) {
                const query = state.searchQuery.toLowerCase();
                filtered = filtered.filter(r => 
                    r.situation.toLowerCase().includes(query) ||
                    (r.insights && r.insights.toLowerCase().includes(query)) ||
                    r.date.includes(query)
                );
            }
            
            // ã‚¿ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿
            if (state.filterTags.length > 0) {
                filtered = filtered.filter(r => 
                    state.filterTags.some(tag => r.tags.includes(tag))
                );
            }
            
            return filtered;
        }

        // JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportJSON() {
            if (state.records.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            const dataStr = JSON.stringify(state.records, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `æ—¥ã€…ã®è¨˜éŒ²_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('JSONãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆGemâ‘£ç”¨ï¼‰
        function exportText() {
            if (state.records.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let text = `# æ—¥ã€…ã®è¨˜éŒ²\n`;
            text += `ä½œæˆæ—¥: ${new Date().toLocaleDateString('ja-JP')}\n`;
            text += `ç·è¨˜éŒ²æ•°: ${state.records.length}\n\n`;
            text += `---\n\n`;
            
            state.records.forEach((r, index) => {
                text += `## è¨˜éŒ² ${index + 1}: ${r.date}\n\n`;
                
                if (r.tags.length > 0) {
                    text += `**ã‚¿ã‚°:** ${r.tags.join(', ')}\n\n`;
                }
                
                text += `**å‡ºæ¥äº‹:**\n${r.situation}\n\n`;
                
                if (r.insights) {
                    text += `**æ°—ã¥ã:**\n${r.insights}\n\n`;
                }
                
                text += `---\n\n`;
            });
            
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `æ—¥ã€…ã®è¨˜éŒ²_Gemâ‘£ç”¨_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            alert('ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ\n\nã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Gemâ‘£ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€æœˆ1å›ã®æŒ¯ã‚Šè¿”ã‚Šã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');
        }

        // æœŸé–“æŒ‡å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆGemâ‘£ç”¨ï¼‰
        function exportPeriod() {
            const startDate = prompt('é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 2025-11-01ï¼‰');
            if (!startDate) return;
            
            const endDate = prompt('çµ‚äº†æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 2025-11-30ï¼‰');
            if (!endDate) return;
            
            const filtered = state.records.filter(r => {
                const recordDate = new Date(r.date);
                return recordDate >= new Date(startDate) && recordDate <= new Date(endDate);
            });
            
            if (filtered.length === 0) {
                alert('æŒ‡å®šæœŸé–“ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let text = `# æ—¥ã€…ã®è¨˜éŒ²ï¼ˆ${startDate} ã€œ ${endDate}ï¼‰\n`;
            text += `ä½œæˆæ—¥: ${new Date().toLocaleDateString('ja-JP')}\n`;
            text += `è¨˜éŒ²æ•°: ${filtered.length}\n\n`;
            text += `---\n\n`;
            
            filtered.forEach((r, index) => {
                text += `## ${r.date}\n\n`;
                
                if (r.tags.length > 0) {
                    text += `**ã‚¿ã‚°:** ${r.tags.join(', ')}\n\n`;
                }
                
                text += `**å‡ºæ¥äº‹:**\n${r.situation}\n\n`;
                
                if (r.insights) {
                    text += `**æ°—ã¥ã:**\n${r.insights}\n\n`;
                }
                
                text += `---\n\n`;
            });
            
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `æ—¥ã€…ã®è¨˜éŒ²_${startDate}_${endDate}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            alert(`${startDate} ã€œ ${endDate} ã®è¨˜éŒ²ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`);
        }

        // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ç¢ºèªï¼ˆæ–°æ©Ÿèƒ½ï¼‰
        function checkStorageData() {
            const saved = localStorage.getItem('daily_records');
            
            if (!saved || saved === '[]') {
                alert('ğŸ“¦ ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª\n\nç¾åœ¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }
            
            try {
                const data = JSON.parse(saved);
                const count = data.length;
                
                // è¨˜éŒ²æœŸé–“ã‚’è¨ˆç®—
                if (count > 0) {
                    const dates = data.map(r => new Date(r.date)).sort((a, b) => a - b);
                    const oldestDate = dates[0].toLocaleDateString('ja-JP');
                    const newestDate = dates[dates.length - 1].toLocaleDateString('ja-JP');
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ï¼ˆæ¦‚ç®—ï¼‰
                    const dataSize = new Blob([saved]).size;
                    const dataSizeKB = (dataSize / 1024).toFixed(2);
                    
                    // æœ€åˆã®5ä»¶ã®æ—¥ä»˜ã‚’è¡¨ç¤º
                    const recentDates = data
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5)
                        .map(r => `  â€¢ ${r.date}`)
                        .join('\n');
                    
                    const message = `ğŸ“¦ ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª\n\n` +
                        `ã€ä¿å­˜çŠ¶æ³ã€‘\n` +
                        `ç·è¨˜éŒ²æ•°: ${count}ä»¶\n` +
                        `è¨˜éŒ²æœŸé–“: ${oldestDate} ã€œ ${newestDate}\n` +
                        `ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${dataSizeKB} KB\n\n` +
                        `ã€æœ€è¿‘ã®è¨˜éŒ²ï¼ˆæœ€å¤§5ä»¶ï¼‰ã€‘\n${recentDates}\n\n` +
                        `ã€ä¿å­˜å ´æ‰€ã€‘\n` +
                        `ãƒ–ãƒ©ã‚¦ã‚¶: ${navigator.userAgent.includes('Chrome') ? 'Chrome' : navigator.userAgent.includes('Safari') ? 'Safari' : navigator.userAgent.includes('Firefox') ? 'Firefox' : 'ãã®ä»–'}\n` +
                        `LocalStorage ã‚­ãƒ¼: daily_records\n\n` +
                        `ã€æ³¨æ„ã€‘\n` +
                        `â€¢ ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¾ã™\n` +
                        `â€¢ å®šæœŸçš„ã«JSONãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„`;
                    
                    if (confirm(message + '\n\nè©³ç´°ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã¾ã™ã‹ï¼Ÿ')) {
                        console.log('=== ä¿å­˜ãƒ‡ãƒ¼ã‚¿è©³ç´° ===');
                        console.log('ç·è¨˜éŒ²æ•°:', count);
                        console.log('ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º:', dataSizeKB, 'KB');
                        console.log('æœ€å¤ã®è¨˜éŒ²:', oldestDate);
                        console.log('æœ€æ–°ã®è¨˜éŒ²:', newestDate);
                        console.log('å…¨ãƒ‡ãƒ¼ã‚¿:', data);
                        alert('è©³ç´°æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã¾ã—ãŸ\n\nç¢ºèªæ–¹æ³•:\n1. F12ã‚­ãƒ¼ã‚’æŠ¼ã™\n2. Consoleã‚¿ãƒ–ã‚’é–‹ã');
                    }
                } else {
                    alert('ğŸ“¦ ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª\n\nãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã™ãŒã€è¨˜éŒ²ãŒ0ä»¶ã§ã™ã€‚');
                }
                
            } catch (e) {
                alert('âŒ ã‚¨ãƒ©ãƒ¼\n\nä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼å†…å®¹: ' + e.message);
                console.error('ãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        
                        if (!Array.isArray(imported)) {
                            alert('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                            return;
                        }
                        
                        // é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆIDãƒ™ãƒ¼ã‚¹ï¼‰
                        const existingIds = new Set(state.records.map(r => r.id));
                        const newRecords = imported.filter(r => !existingIds.has(r.id));
                        
                        if (newRecords.length === 0) {
                            alert('æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆã™ã¹ã¦æ—¢å­˜ï¼‰');
                            return;
                        }
                        
                        if (confirm(`${newRecords.length}ä»¶ã®æ–°ã—ã„è¨˜éŒ²ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã‹ï¼Ÿ`)) {
                            state.records = [...state.records, ...newRecords];
                            state.records.sort((a, b) => new Date(b.date) - new Date(a.date));
                            saveData();
                            render();
                            alert(`${newRecords.length}ä»¶ã®è¨˜éŒ²ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
                        }
                    } catch (e) {
                        alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ãƒ‡ãƒ¼ã‚¿å…¨å‰Šé™¤
        function clearAllData() {
            if (!confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚\näº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚')) {
                return;
            }
            
            if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
            
            state.records = [];
            saveData();
            render();
            alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function render() {
            const stats = getStats();
            const app = document.getElementById('app');

            app.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50">
                    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                    <div class="bg-white shadow-sm border-b no-print">
                        <div class="max-w-7xl mx-auto px-4 py-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h1 class="text-2xl font-bold text-gray-900">æ—¥ã€…ã®è¨˜éŒ²</h1>
                                    <p class="text-sm text-gray-600">å®Œå…¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜</p>
                                </div>
                                <button onclick="openAddForm()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                                    â• æ–°è¦è¨˜éŒ²
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ãƒŠãƒ“ -->
                    <div class="max-w-7xl mx-auto px-4 py-4 no-print">
                        <div class="flex gap-2">
                            <button onclick="changeView('dashboard')" class="px-4 py-2 rounded-lg ${state.view === 'dashboard' ? 'bg-white shadow' : 'bg-white/50'}">
                                ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                            </button>
                            <button onclick="changeView('records')" class="px-4 py-2 rounded-lg ${state.view === 'records' ? 'bg-white shadow' : 'bg-white/50'}">
                                ğŸ“ è¨˜éŒ²ä¸€è¦§
                            </button>
                            <button onclick="changeView('export')" class="px-4 py-2 rounded-lg ${state.view === 'export' ? 'bg-white shadow' : 'bg-white/50'}">
                                ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                            </button>
                        </div>
                    </div>

                    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                    <div class="max-w-7xl mx-auto px-4 py-6">
                        ${state.view === 'dashboard' ? renderDashboard(stats) : 
                          state.view === 'records' ? renderRecords() : 
                          renderExport()}
                    </div>
                </div>

                ${state.showAddForm ? renderAddForm() : ''}
                ${state.selectedRecord ? renderDetail() : ''}
            `;
        }

        function renderDashboard(stats) {
            return `
                <div class="space-y-6">
                    <!-- çµ±è¨ˆ -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="text-sm text-gray-600 mb-1">ç·è¨˜éŒ²æ•°</div>
                            <div class="text-3xl font-bold text-indigo-600">${stats.total}</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="text-sm text-gray-600 mb-1">éå»7æ—¥é–“</div>
                            <div class="text-3xl font-bold text-green-600">${stats.last7Days}</div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="text-sm text-gray-600 mb-1">å¹³å‡ï¼ˆé€±ï¼‰</div>
                            <div class="text-3xl font-bold text-purple-600">${stats.total > 0 ? (stats.last7Days).toFixed(1) : 0}</div>
                        </div>
                    </div>

                    <!-- ã‚¿ã‚°åˆ¥é›†è¨ˆ -->
                    ${Object.keys(stats.tagCounts).length > 0 ? `
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">ã‚¿ã‚°åˆ¥é›†è¨ˆ</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                ${Object.entries(stats.tagCounts)
                                    .sort((a, b) => b[1] - a[1])
                                    .slice(0, 8)
                                    .map(([tag, count]) => `
                                    <div class="p-3 border rounded-lg">
                                        <div class="text-sm text-gray-600">${tag}</div>
                                        <div class="text-2xl font-bold text-indigo-600">${count}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- æœ€è¿‘ã®è¨˜éŒ² -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">æœ€è¿‘ã®è¨˜éŒ²ï¼ˆ5ä»¶ï¼‰</h3>
                        ${state.records.length === 0 ? `
                            <div class="text-center py-8 text-gray-500">
                                ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã€Œæ–°è¦è¨˜éŒ²ã€ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚
                            </div>
                        ` : `
                            <div class="space-y-3">
                                ${state.records.slice(0, 5).map(r => `
                                    <div onclick="openDetail(${r.id})" class="p-4 border rounded-lg hover:bg-indigo-50 cursor-pointer">
                                        <div class="flex justify-between mb-2">
                                            <span class="font-medium">${r.date}</span>
                                            <div class="flex gap-1 flex-wrap justify-end">
                                                ${r.tags.map(t => `
                                                    <span class="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded">${t}</span>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div class="text-gray-700">${r.situation.length > 100 ? r.situation.substring(0, 100) + '...' : r.situation}</div>
                                        ${r.insights ? `<div class="mt-2 text-sm text-gray-600">ğŸ’¡ ${r.insights.length > 50 ? r.insights.substring(0, 50) + '...' : r.insights}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>

                    <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-sm p-6 text-white no-print">
                        <h3 class="text-lg font-semibold mb-2">ğŸ’¡ Gemâ‘£ã¨ã®é€£æº</h3>
                        <p class="text-sm opacity-90 mb-4">
                            æœˆ1å›ã€è¨˜éŒ²ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€Gemâ‘£ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã€è©³ç´°ãªåˆ†æã¨æŒ¯ã‚Šè¿”ã‚ŠãŒã§ãã¾ã™ã€‚
                        </p>
                        <button onclick="changeView('export')" class="bg-white text-indigo-600 px-4 py-2 rounded-lg hover:bg-gray-100">
                            ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã¸
                        </button>
                    </div>
                </div>
            `;
        }

        function renderRecords() {
            const filtered = getFilteredRecords();
            
            return `
                <div class="space-y-4">
                    <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                    <div class="bg-white rounded-xl shadow-sm p-4 no-print">
                        <div class="space-y-3">
                            <div>
                                <input type="text" 
                                    id="search-input"
                                    placeholder="ğŸ” æ¤œç´¢ï¼ˆå‡ºæ¥äº‹ã€æ°—ã¥ãã€æ—¥ä»˜ï¼‰" 
                                    value="${state.searchQuery}"
                                    oninput="updateSearch(this.value)"
                                    class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            
                            <div>
                                <div class="text-sm font-medium mb-2">ã‚¿ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:</div>
                                <div class="flex flex-wrap gap-2">
                                    ${tagOptions.map(tag => `
                                        <button onclick="toggleFilterTag('${tag}')" type="button"
                                            class="px-3 py-1 text-sm rounded-full ${
                                                state.filterTags.includes(tag) 
                                                    ? 'bg-indigo-600 text-white' 
                                                    : 'bg-gray-200 text-gray-700'
                                            }">
                                            ${tag}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                            
                            ${state.searchQuery || state.filterTags.length > 0 ? `
                                <div class="flex justify-between items-center pt-2 border-t">
                                    <span class="text-sm text-gray-600">
                                        ${filtered.length}ä»¶ã®è¨˜éŒ²ã‚’è¡¨ç¤ºä¸­
                                    </span>
                                    <button onclick="clearFilters()" class="text-sm text-indigo-600 hover:underline">
                                        ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- è¨˜éŒ²ä¸€è¦§ -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">
                            ${state.searchQuery || state.filterTags.length > 0 ? 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœ' : 'ã™ã¹ã¦ã®è¨˜éŒ²'}
                            ï¼ˆ${filtered.length}ä»¶ï¼‰
                        </h3>
                        ${filtered.length === 0 ? `
                            <div class="text-center py-8 text-gray-500">
                                ${state.searchQuery || state.filterTags.length > 0 
                                    ? 'æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“' 
                                    : 'è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“'}
                            </div>
                        ` : `
                            <div class="space-y-3">
                                ${filtered.map(r => `
                                    <div onclick="openDetail(${r.id})" class="p-4 border rounded-lg hover:bg-indigo-50 cursor-pointer">
                                        <div class="flex justify-between mb-2">
                                            <span class="font-medium">${r.date}</span>
                                            <div class="flex gap-1 flex-wrap justify-end">
                                                ${r.tags.map(t => `
                                                    <span class="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded">${t}</span>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div class="text-gray-700">${r.situation}</div>
                                        ${r.insights ? `<div class="mt-2 text-sm text-gray-600 bg-yellow-50 p-2 rounded">ğŸ’¡ ${r.insights}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderExport() {
            return `
                <div class="space-y-6">
                    <!-- Gemâ‘£é€£æº -->
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                        <h2 class="text-2xl font-bold mb-2">ğŸ“¤ Gemâ‘£ã¨ã®é€£æº</h2>
                        <p class="opacity-90 mb-4">
                            è¨˜éŒ²ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€Gemâ‘£ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã€
                            æœˆ1å›ã®è©³ç´°ãªæŒ¯ã‚Šè¿”ã‚Šã¨åˆ†æãŒã§ãã¾ã™ã€‚
                        </p>
                    </div>

                    <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-3">ğŸ“„ ãƒ†ã‚­ã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆæ¨å¥¨ï¼‰</h3>
                            <p class="text-sm text-gray-600 mb-4">
                                ã™ã¹ã¦ã®è¨˜éŒ²ã‚’ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‚Gemâ‘£ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦æœˆ1å›ã®æŒ¯ã‚Šè¿”ã‚Šã«ä½¿ç”¨ã—ã¾ã™ã€‚
                            </p>
                            <button 
                                onclick="exportText()" 
                                class="w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 disabled:opacity-50"
                                ${state.records.length === 0 ? 'disabled' : ''}>
                                ğŸ“„ ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                            </button>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-3">ğŸ“… æœŸé–“æŒ‡å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
                            <p class="text-sm text-gray-600 mb-4">
                                ç‰¹å®šæœŸé–“ã®è¨˜éŒ²ã®ã¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‚æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã®ä½œæˆã«ä¾¿åˆ©ã§ã™ã€‚
                            </p>
                            <button 
                                onclick="exportPeriod()" 
                                class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 disabled:opacity-50"
                                ${state.records.length === 0 ? 'disabled' : ''}>
                                ğŸ“… æœŸé–“ã‚’æŒ‡å®šã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                            </button>
                        </div>
                    </div>

                    <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒ -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨å¾©å…ƒ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <button 
                                onclick="checkStorageData()" 
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                ğŸ“Š ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
                            </button>
                            <button 
                                onclick="exportJSON()" 
                                class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50"
                                ${state.records.length === 0 ? 'disabled' : ''}>
                                ğŸ’¾ JSONãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                            </button>
                            <button 
                                onclick="importData()" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                            </button>
                            <button 
                                onclick="clearAllData()" 
                                class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 disabled:opacity-50"
                                ${state.records.length === 0 ? 'disabled' : ''}>
                                ğŸ—‘ï¸ ã™ã¹ã¦å‰Šé™¤
                            </button>
                        </div>
                        <div class="mt-4 text-sm text-gray-600 bg-yellow-50 p-3 rounded">
                            <strong>âš ï¸ é‡è¦:</strong> ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤ã§è¨˜éŒ²ãŒæ¶ˆãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                            å®šæœŸçš„ã«JSONãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚
                        </div>
                    </div>

                    <!-- ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“– Gemâ‘£ã¨ã®é€£æºæ–¹æ³•</h3>
                        <div class="space-y-3 text-sm text-gray-700">
                            <div class="flex gap-3">
                                <div class="flex-shrink-0 w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs font-bold">1</div>
                                <div>
                                    <strong>è¨˜éŒ²ã‚’è“„ç©ã™ã‚‹</strong><br>
                                    æ—¥ã€…ã®å‡ºæ¥äº‹ã€æ°—ã¥ãã€ã‚¿ã‚°ã‚’è¨˜éŒ²ã—ã¦ã„ãã¾ã™ã€‚
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="flex-shrink-0 w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs font-bold">2</div>
                                <div>
                                    <strong>æœˆ1å›ã€ãƒ†ã‚­ã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</strong><br>
                                    ä¸Šè¨˜ã®ã€Œãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="flex-shrink-0 w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs font-bold">3</div>
                                <div>
                                    <strong>Gemâ‘£ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</strong><br>
                                    Gemâ‘£ã‚’é–‹ãã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="flex-shrink-0 w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs font-bold">4</div>
                                <div>
                                    <strong>æŒ¯ã‚Šè¿”ã‚Šã¨åˆ†æ</strong><br>
                                    Gemâ‘£ãŒè¨˜éŒ²ã‚’åˆ†æã—ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æŠ½å‡ºã€é€²æ—ã®å¯è¦–åŒ–ã€æ¥æœˆã®ç›®æ¨™ã‚’ææ¡ˆã—ã¾ã™ã€‚
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- çµ±è¨ˆæƒ…å ± -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">ğŸ“Š ç¾åœ¨ã®è¨˜éŒ²çŠ¶æ³</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <div class="text-sm text-gray-600">ç·è¨˜éŒ²æ•°</div>
                                <div class="text-2xl font-bold text-indigo-600">${state.records.length}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">æœ€å¤ã®è¨˜éŒ²</div>
                                <div class="text-sm font-medium">${state.records.length > 0 ? state.records[state.records.length - 1].date : '-'}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">æœ€æ–°ã®è¨˜éŒ²</div>
                                <div class="text-sm font-medium">${state.records.length > 0 ? state.records[0].date : '-'}</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-600">è¨˜éŒ²æœŸé–“</div>
                                <div class="text-sm font-medium">
                                    ${state.records.length > 1 ? 
                                        Math.ceil((new Date(state.records[0].date) - new Date(state.records[state.records.length - 1].date)) / (1000 * 60 * 60 * 24)) + 'æ—¥é–“' 
                                        : '-'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAddForm() {
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b sticky top-0 bg-white">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold">æ–°ã—ã„è¨˜éŒ²</h2>
                                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                            </div>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">æ—¥ä»˜ *</label>
                                <input type="date" id="input-date" value="${state.newRecord.date}" 
                                    class="w-full px-4 py-2 border rounded-lg">
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">ä»Šæ—¥ã®å‡ºæ¥äº‹ *</label>
                                <textarea id="input-situation" rows="4" 
                                    placeholder="ä½•ãŒèµ·ãã¾ã—ãŸã‹ï¼Ÿ&#10;ä¾‹ï¼šæœã€ç™»æ ¡æº–å‚™ã§ç™‡ç™ªã‚’èµ·ã“ã—ã¾ã—ãŸ"
                                    class="w-full px-4 py-2 border rounded-lg">${state.newRecord.situation}</textarea>
                                <div class="text-xs text-gray-500 mt-1">
                                    ã§ãã‚‹ã ã‘å…·ä½“çš„ã«è¨˜éŒ²ã—ã¦ãã ã•ã„
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">æ°—ã¥ããƒ»ãƒ¡ãƒ¢</label>
                                <textarea id="input-insights" rows="3" 
                                    placeholder="ã“ã®å‡ºæ¥äº‹ã‹ã‚‰åˆ†ã‹ã£ãŸã“ã¨&#10;ä¾‹ï¼šè¤‡æ•°ã®æŒ‡ç¤ºã‚’å‡ºã—ã¦ã—ã¾ã£ãŸã®ãŒåŸå› ã‹ã‚‚"
                                    class="w-full px-4 py-2 border rounded-lg">${state.newRecord.insights}</textarea>
                                <div class="text-xs text-gray-500 mt-1">
                                    ã†ã¾ãã„ã£ãŸæ™‚ã®è¦å› ã€ã†ã¾ãã„ã‹ãªã‹ã£ãŸæ™‚ã®è¦å› ãªã©
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">ã‚¿ã‚°</label>
                                <div class="flex flex-wrap gap-2">
                                    ${tagOptions.map(tag => `
                                        <button onclick="toggleTag('${tag}')" type="button"
                                            class="px-3 py-1 text-sm rounded-full transition-colors ${
                                                state.newRecord.tags.includes(tag) 
                                                    ? 'bg-indigo-600 text-white' 
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }">
                                            ${tag}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>

                        <div class="p-6 border-t bg-gray-50 flex gap-3">
                            <button onclick="closeModal()" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-100">
                                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                            </button>
                            <button onclick="saveRecord()" class="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                                ä¿å­˜
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDetail() {
            const r = state.selectedRecord;
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b sticky top-0 bg-white">
                            <div class="flex justify-between items-center">
                                <h2 class="text-xl font-bold">${r.date} ã®è¨˜éŒ²</h2>
                                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button>
                            </div>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            ${r.tags.length > 0 ? `
                                <div class="flex gap-2 flex-wrap">
                                    ${r.tags.map(t => `
                                        <span class="px-3 py-1 bg-indigo-100 text-indigo-700 text-sm rounded-full">${t}</span>
                                    `).join('')}
                                </div>
                            ` : ''}

                            <div>
                                <h3 class="font-semibold mb-2 text-gray-700">å‡ºæ¥äº‹</h3>
                                <p class="text-gray-900 whitespace-pre-wrap">${r.situation}</p>
                            </div>

                            ${r.insights ? `
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                    <h3 class="font-semibold mb-2 text-gray-700">ğŸ’¡ æ°—ã¥ã</h3>
                                    <p class="text-gray-900 whitespace-pre-wrap">${r.insights}</p>
                                </div>
                            ` : ''}
                            
                            <div class="text-xs text-gray-500 pt-2 border-t">
                                ä½œæˆæ—¥æ™‚: ${new Date(r.createdAt).toLocaleString('ja-JP')}
                            </div>
                        </div>

                        <div class="p-6 border-t flex justify-between">
                            <button onclick="closeModal()" class="px-4 py-2 border rounded-lg hover:bg-gray-100">
                                é–‰ã˜ã‚‹
                            </button>
                            <button onclick="deleteRecord(${r.id})" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                ğŸ—‘ï¸ å‰Šé™¤
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ï¼‰
        function openAddForm() {
            state.showAddForm = true;
            render();
            // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’çŠ¶æ³å…¥åŠ›æ¬„ã«
            setTimeout(() => {
                const input = document.getElementById('input-situation');
                if (input) input.focus();
            }, 100);
        }

        function closeModal() {
            state.showAddForm = false;
            state.selectedRecord = null;
            render();
        }

        function changeView(view) {
            state.view = view;
            render();
        }

        function saveRecord() {
            // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å€¤ã‚’å–å¾—
            state.newRecord.date = document.getElementById('input-date').value;
            state.newRecord.situation = document.getElementById('input-situation').value;
            state.newRecord.insights = document.getElementById('input-insights').value;
            addRecord();
        }

        function openDetail(id) {
            state.selectedRecord = state.records.find(r => r.id === id);
            render();
        }

        function deleteRecord(id) {
            if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                state.records = state.records.filter(r => r.id !== id);
                saveData();
                state.selectedRecord = null;
                render();
            }
        }

        function updateSearch(query) {
            state.searchQuery = query;
            render();
        }

        function clearFilters() {
            state.searchQuery = '';
            state.filterTags = [];
            render();
        }

        // åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', () => {
            loadData();
            render();
        });

        // ãƒ‡ãƒ¼ã‚¿ã®å®šæœŸä¿å­˜ï¼ˆ5åˆ†ã”ã¨ï¼‰
        setInterval(() => {
            if (state.records.length > 0) {
                saveData();
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
